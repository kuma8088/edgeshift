name = "edgeshift-newsletter"
main = "src/index.ts"
compatibility_date = "2024-12-01"
workers_dev = false

# Production routes - need both exact and wildcard patterns
[[routes]]
pattern = "edgeshift.tech/api/newsletter/*"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/campaigns"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/campaigns/*"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/sequences"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/sequences/*"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/subscribers/*"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/dashboard/*"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/webhooks/*"
zone_name = "edgeshift.tech"

[[routes]]
pattern = "edgeshift.tech/api/analytics/*"
zone_name = "edgeshift.tech"

[vars]
ALLOWED_ORIGIN = "https://edgeshift.tech"
SENDER_EMAIL = "newsletter@mail.edgeshift.tech"
SENDER_NAME = "EdgeShift Newsletter"
SITE_URL = "https://edgeshift.tech"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "edgeshift-newsletter"
database_id = "4ca2faf7-7486-4a66-b153-278acfa10d17"

# Cron trigger for scheduled campaigns (every 15 minutes)
[triggers]
crons = ["*/15 * * * *"]

# Secrets (set via `wrangler secret put <NAME>`):
# - RESEND_API_KEY
# - TURNSTILE_SECRET_KEY
# - ADMIN_API_KEY
# - RESEND_WEBHOOK_SECRET (for webhook signature verification)
